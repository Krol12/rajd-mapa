<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa Rajdu</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map { height: 100vh; }

  /* Pole tytułowe */
  .title {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    background: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }

  /* Menu dni */
  .day-menu { 
    position: absolute; 
    top: 50px; 
    left: 50%; 
    transform: translateX(-50%); 
    z-index: 1000; 
    background: white; 
    padding: 5px; 
    border-radius: 8px; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  .day-menu button { 
    margin: 2px; 
    padding: 8px 14px; 
    font-size: 16px; 
    border: none; 
    border-radius: 5px;
    background-color: #f0f0f0;
    cursor: pointer;
    transition: 0.2s;
  }
  .day-menu button:hover { background-color: #d0e0ff; }
  .day-menu button.active { background-color: #007bff; color: white; }

  /* Przycisk lokalizacji */
  #locateBtn {
    position: absolute;
    bottom: 20px;
    left: 20px;
    z-index: 1000;
    padding: 10px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div class="title">Rajd w dniach</div>

<div class="day-menu">
  <button onclick="showDay(1)">Dzień 1</button>
  <button onclick="showDay(2)">Dzień 2</button>
  <button onclick="showDay(3)">Dzień 3</button>
  <button onclick="showDay(4)">Dzień 4</button>
  <button onclick="showDay(5)">Dzień 5</button>
</div>

<button id="locateBtn">Znajdź moją lokalizację</button>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Inicjalizacja mapy
var map = L.map('map').setView([52.32, 16.85], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Ikony
var blueIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
  iconSize: [25,41],
  iconAnchor: [12,41],
  popupAnchor: [1,-34],
  shadowSize: [41,41]
});

var redIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
  iconSize: [25,41],
  iconAnchor: [12,41],
  popupAnchor: [1,-34],
  shadowSize: [41,41]
});

// Punkty rajdu (przykładowe, można wczytać z JSON)
var pointsData = [
  {"day":1,"lat":52.322258,"lng":16.856098,"name":"Punkt 1"},
  {"day":1,"lat":52.320904,"lng":16.853241,"name":"Punkt 2"},
  {"day":2,"lat":52.317755,"lng":16.846434,"name":"Punkt 1 Dnia 2"},
  {"day":2,"lat":52.318990,"lng":16.827553,"name":"Punkt 2 Dnia 2"},
  {"day":3,"lat":52.310389,"lng":16.842472,"name":"Punkt 1 Dnia 3"}
];

var currentDay = 1;
var markers = [];

function showDay(day){
  currentDay = day;
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  var dayPoints = pointsData.filter(p => p.day === day);
  dayPoints.forEach(p => {
    var m = L.marker([p.lat, p.lng], {icon: blueIcon}).addTo(map).bindPopup(p.name);
    markers.push(m);
  });
}

// Wyświetlamy dzień 1 na start
showDay(1);

// Lokalizacja użytkownika
var userMarker = null;

function locateUser(){
  map.locate({setView: true, maxZoom: 16});
}

document.getElementById('locateBtn').addEventListener('click', locateUser);

function onLocationFound(e){
  if(!userMarker){
    userMarker = L.marker(e.latlng, {icon: redIcon}).addTo(map).bindPopup('Twoja pozycja');
  } else {
    userMarker.setLatLng(e.latlng);
  }
}

map.on('locationfound', onLocationFound);
map.on('locationerror', function(e){ alert('Nie można określić lokalizacji: ' + e.message); });
</script>
</body>
</html>

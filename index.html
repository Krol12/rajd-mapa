<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa Rajdu</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map { height: 100vh; }

  /* Tytu≈Ç */
  #title { 
    position: absolute; 
    top: 10px; 
    left: 50%; 
    transform: translateX(-50%); 
    z-index: 1000; 
    background: white; 
    padding: 8px 15px; 
    border-radius: 8px; 
    font-size: 18px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }

  /* Menu dni */
  .day-menu { 
    position: absolute; 
    top: 50px; 
    left: 50%; 
    transform: translateX(-50%); 
    z-index: 1000; 
    background: white; 
    padding: 5px; 
    border-radius: 8px; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  .day-menu button { 
    margin: 2px; 
    padding: 8px 14px; 
    font-size: 16px; 
    border: none; 
    border-radius: 5px;
    background-color: #f0f0f0;
    cursor: pointer;
    transition: 0.2s;
  }
  .day-menu button:hover { background-color: #d0e0ff; }
  .day-menu button.active { background-color: #007bff; color: white; }

  /* Przyciski lokalizacji */
  .loc-btn { 
    position: absolute; 
    top: 100px; 
    left: 50%; 
    transform: translateX(-50%);
    z-index: 1000; 
  }
  .loc-btn button {
    padding: 8px 14px; 
    font-size: 16px; 
    border: none; 
    border-radius: 5px;
    background-color: #28a745;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="title">Rajd w dniach 1-5</div>

<div class="day-menu">
  <button onclick="showDay(1)">Dzie≈Ñ 1</button>
  <button onclick="showDay(2)">Dzie≈Ñ 2</button>
  <button onclick="showDay(3)">Dzie≈Ñ 3</button>
  <button onclick="showDay(4)">Dzie≈Ñ 4</button>
  <button onclick="showDay(5)">Dzie≈Ñ 5</button>
</div>

<div class="loc-btn">
  <button onclick="findUserLocation()">Znajd≈∫ mojƒÖ lokalizacjƒô</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
var map = L.map('map').setView([52.237, 21.017], 13);

// Tile layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Zmienna na dane punkt√≥w
let pointsData = [];

// Wczytanie punkt√≥w z zewnƒôtrznego JSON
fetch('punkty.json')
  .then(res => res.json())
  .then(data => {
      pointsData = data.map(p => ({ ...p, visited: false })); // dodajemy visited
      showDay(1); // startowy dzie≈Ñ
  })
  .catch(err => console.error("B≈ÇƒÖd wczytywania punkt√≥w:", err));

var currentDay = 1;
var markers = [];
var userMarker = null;

// Funkcja wy≈õwietlania punkt√≥w danego dnia
function showDay(day){
  currentDay = day;
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  document.querySelectorAll('.day-menu button').forEach(b => b.classList.remove('active'));
  document.querySelector(`.day-menu button:nth-child(${day})`)?.classList.add('active');

  var dayPoints = pointsData.filter(p => p.day === day);
  dayPoints.forEach(p => {
    let m = L.marker([p.lat, p.lng], {icon: L.icon({
        iconUrl:'https://cdn-icons-png.flaticon.com/512/64/64096.png', // niebieski marker
        iconSize:[32,32],
        iconAnchor:[16,32]
    })}).addTo(map).bindPopup(p.name);
    markers.push(m);
  });

  if(dayPoints.length > 0){
    map.setView([dayPoints[0].lat, dayPoints[0].lng], 15);
  }
}

// Funkcja do wyszukiwania lokalizacji u≈ºytkownika
function findUserLocation(){
  map.locate({setView: false, maxZoom:16});
}

// Obs≈Çuga znalezienia lokalizacji
function onLocationFound(e){
  if(!userMarker){
    userMarker = L.marker(e.latlng, {icon:L.icon({
      iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', // czerwony marker
      iconSize:[32,32],
      iconAnchor:[16,32]
    })}).addTo(map).bindPopup('Twoja pozycja');
  } else {
    userMarker.setLatLng(e.latlng);
  }
  updateVisitedPoints(e.latlng);
}

// Funkcja sprawdzajƒÖca odleg≈Ço≈õƒá do punkt√≥w i pokazujƒÖca komunikaty
function updateVisitedPoints(latlng){
  let dayPoints = pointsData.filter(p => p.day === currentDay);
  dayPoints.forEach(p => {
    let distance = map.distance(latlng, L.latLng(p.lat, p.lng));
    if(distance < 50 && !p.visited){  // 50 metr√≥w i jeszcze niezaliczony
      p.visited = true;
      showToast("‚úÖ Zaliczy≈Çe≈õ punkt: " + p.name);
    }
  });

  if(dayPoints.length > 0 && dayPoints.every(p => p.visited)){
    showToast("üéâ Zaliczy≈Çe≈õ wszystkie punkty dnia " + currentDay);
  }
}

// Komunikaty z przyciskiem OK
function showToast(msg){
  let toast = document.createElement("div");
  toast.innerHTML = `<div style="
    background: rgba(0,0,0,0.9); 
    color: white; 
    padding: 15px 20px; 
    border-radius: 8px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    min-width: 250px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  ">
    <span>${msg}</span>
    <button style="
      margin-left: 10px; 
      padding: 5px 10px; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer;
      background: #007bff;
      color: white;
    ">OK</button>
  </div>`;
  toast.style.position = "fixed";
  toast.style.bottom = "20px";
  toast.style.left = "50%";
  toast.style.transform = "translateX(-50%)";
  toast.style.zIndex = "2000";
  document.body.appendChild(toast);

  toast.querySelector("button").addEventListener("click", () => {
    toast.remove();
  });
}

// Eventy lokalizacji
map.on('locationfound', onLocationFound);
map.on('locationerror', function(e){ alert('Nie mo≈ºna okre≈õliƒá lokalizacji: ' + e.message); });

</script>
</body>
</html>
